= Local Kubernetes Installation using Minikube

== Setup Minikube

Minikube v0.23.0 or higher is required for docker server https://github.com/moby/moby/pull/31352[17.05],
which adds support for using `ARG` in `FROM` in your `Dockerfile`.

This is how Confluent Docker images are built with our standard build/CI pipeline.

For macOS [Minikube installation instructions](https://github.com/kubernetes/minikube):

[source,shell]
----
$ brew cask install minikube
----

Following https://github.com/kubernetes/minikube/releases[install instructions].

[source,shell]
----
$ curl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.23.0/minikube-darwin-amd64 && chmod +x minikube && sudo mv minikube /usr/local/bin/
----

Following https://github.com/kubernetes/minikube/blob/master/DRIVERS.md#xhyve-driver[driver instructions]

[source,shell]
----
$ brew install docker-machine-driver-xhyve
$ sudo chown root:wheel /usr/local/opt/docker-machine-driver-xhyve/bin/docker-machine-driver-xhyve
$ sudo chmod u+s /usr/local/opt/docker-machine-driver-xhyve/bin/docker-machine-driver-xhyve
----

== Start Minikube

Start Minikube, not that the memory has been increased to 6096 MB.

[source,shell]
----
$ minikube start --kubernetes-version v1.8.0 --cpus 4 --memory 6096 --vm-driver=xhyve --v=8
----

Check status until both minikube and cluster are in Running state

[source,shell]
----
$ minikube status
minikube: Running
cluster: Running
kubectl: Correctly Configured: pointing to minikube-vm at 192.168.99.106
----

Configure the minikube VM.

[source,shell]
----
$ minikube ssh
  sudo ip link set docker0 promisc on
  exit
----

Set the context.

[source,shell]
----
$ eval $(minikube docker-env)

$ kubectl config set-context minikube.internal --cluster=minikube --user=minikube
Context "minikube.internal" modified.

$ kubectl config use-context minikube.internal
Switched to context "minikube.internal".
----

== Verify Local Kubernetes Environment

[source,shell]
----
$ kubectl config current-context
minikube.internal

$ kubectl cluster-info
Kubernetes master is running at https://192.168.99.106:8443
KubeDNS is running at https://192.168.99.106:8443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy

To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.
----
